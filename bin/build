#!/usr/bin/env nu

source keymap.nu

def transform [key: string] {
  let parts = $key | parse "{fn}[{args}]" | get -i 0

  if $key in $keymap {
    $keymap | get $key
  } else if ($parts | is-not-empty) {
    $"(transform $parts.fn)\((transform $parts.args))"
  } else {
    $key
  }
}

def main [] {
  open data/keebler.nuon
  | get layer_map
  | values
  | each {|layer|
    compact
    | each {|key|
      into string
      | transform $in
    }
  }
  | to nuon
}
